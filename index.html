<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Empire â€“ Correct Scaling</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
  font-family: Arial, sans-serif;
  color: white;
}

#ui {
  position: fixed;
  left: 0;
  top: 0;
  width: 220px;
  height: 100%;
  background: #111;
  border-right: 1px solid #0f0;
  padding: 10px;
  box-sizing: border-box;
  z-index: 10;
}

canvas {
  position: absolute;
  left: 220px;
  top: 0;
  background: black;
}
</style>
</head>

<body>

<div id="ui">
  <b>FLEETS</b><br><br>
  Fleet 1<br>
  <span style="color:#0f0">IDLE</span><br><br>
  <b>Galaxy View</b><br>
  Mouse Wheel = Zoom<br>
  Drag = Pan
</div>

<canvas id="game"></canvas>

<script>
/* ==========================
   CANVAS + CONTEXT
========================== */
const canvas = document.getElementById("game");

function resize() {
  canvas.width = window.innerWidth - 220;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const ctx = canvas.getContext("2d");
if (!ctx) {
  alert("Canvas context failed");
}

/* ==========================
   CAMERA
========================== */
const camera = {
  x: 0,
  y: 0,
  zoom: 0.25
};

/* ==========================
   REAL SIZES (NEVER CHANGE)
========================== */
const SIZE = {
  GALAXY_STAR: 80,
  SUN: 140,
  PLANET: 22,
  ORBIT_GAP: 170,
  FLEET: 10
};

/* ==========================
   ZOOM LAYERS
========================== */
const LAYER = {
  GALAXY: 0.03,
  SYSTEM: 0.15,
  LOCAL: 0.6
};

/* ==========================
   WORLD DATA
========================== */
const system = { x: 0, y: 0, planets: 4 };
const fleet = { x: 260, y: -120 };

const backgroundStars = [];
for (let i = 0; i < 900; i++) {
  backgroundStars.push({
    x: Math.random() * 8000 - 4000,
    y: Math.random() * 8000 - 4000
  });
}

/* ==========================
   HELPERS
========================== */
function toScreen(x, y) {
  return {
    x: (x - camera.x) * camera.zoom + canvas.width / 2,
    y: (y - camera.y) * camera.zoom + canvas.height / 2
  };
}

function circle(x, y, r, color) {
  const p = toScreen(x, y);
  ctx.beginPath();
  ctx.arc(p.x, p.y, r * camera.zoom, 0, Math.PI * 2);
  ctx.fillStyle = color;
  ctx.fill();
}

/* ==========================
   DRAW
========================== */
function drawBackground() {
  ctx.fillStyle = "white";
  for (const s of backgroundStars) {
    const p = toScreen(s.x, s.y);
    ctx.fillRect(p.x, p.y, 1, 1);
  }
}

function drawGalaxy() {
  circle(system.x, system.y, SIZE.GALAXY_STAR, "#00ff66");
}

function drawSystem(time) {
  circle(system.x, system.y, SIZE.SUN, "#ffff55");

  for (let i = 1; i <= system.planets; i++) {
    const a = time * 0.00015 * i;
    const d = i * SIZE.ORBIT_GAP;
    circle(
      system.x + Math.cos(a) * d,
      system.y + Math.sin(a) * d,
      SIZE.PLANET,
      "#66aaff"
    );
  }
}

function drawFleet() {
  circle(fleet.x, fleet.y, SIZE.FLEET, "#ff3333");
}

/* ==========================
   INPUT
========================== */
let dragging = false;
let last = { x: 0, y: 0 };

canvas.addEventListener("mousedown", e => {
  dragging = true;
  last.x = e.clientX;
  last.y = e.clientY;
});
window.addEventListener("mouseup", () => dragging = false);
window.addEventListener("mousemove", e => {
  if (!dragging) return;
  camera.x -= (e.clientX - last.x) / camera.zoom;
  camera.y -= (e.clientY - last.y) / camera.zoom;
  last.x = e.clientX;
  last.y = e.clientY;
});
canvas.addEventListener("wheel", e => {
  camera.zoom *= e.deltaY > 0 ? 0.9 : 1.1;
  camera.zoom = Math.max(0.01, Math.min(2, camera.zoom));
});

/* ==========================
   LOOP
========================== */
function loop(time) {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  drawBackground();

  if (camera.zoom >= LAYER.GALAXY) drawGalaxy();
  if (camera.zoom >= LAYER.SYSTEM) drawSystem(time);
  if (camera.zoom >= LAYER.LOCAL) drawFleet();

  requestAnimationFrame(loop);
}
loop(0);
</script>

</body>
</html>
