<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Empire â€“ Correct Scaling</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
  }
  #ui {
    position: fixed;
    left: 0;
    top: 0;
    width: 220px;
    height: 100%;
    background: #111;
    border-right: 1px solid #0f0;
    padding: 10px;
    box-sizing: border-box;
  }
  canvas {
    position: absolute;
    left: 220px;
    top: 0;
  }
</style>
</head>
<body>

<div id="ui">
  <b>FLEETS</b><br><br>
  Fleet 1<br>
  <span style="color:#0f0">IDLE</span><br><br>
  <b>Galaxy View</b><br>
  Mouse Wheel = Zoom<br>
  Drag = Pan
</div>

<canvas id="game"></canvas>

<script>
/* ==========================
   CANVAS + CAMERA
========================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth - 220;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const camera = {
  x: 0,
  y: 0,
  zoom: 0.25
};

/* ==========================
   CONSTANT REAL SIZES
========================== */
const SIZE = {
  GALAXY_STAR: 80,     // star system icon
  SUN: 140,            // system sun
  PLANET: 22,          // planets
  ORBIT_GAP: 170,
  FLEET: 10
};

/* ==========================
   VISIBILITY THRESHOLDS
========================== */
const LAYER = {
  GALAXY: 0.03,
  SYSTEM: 0.15,
  LOCAL: 0.6
};

/* ==========================
   WORLD OBJECTS
========================== */
const system = {
  x: 0,
  y: 0,
  planets: 4
};

const fleet = {
  x: 260,
  y: -120
};

/* ==========================
   BACKGROUND STARS (STATIC)
========================== */
const backgroundStars = [];
for (let i = 0; i < 800; i++) {
  backgroundStars.push({
    x: Math.random() * 8000 - 4000,
    y: Math.random() * 8000 - 4000
  });
}

/* ==========================
   HELPERS
========================== */
function toScreen(x, y) {
  return {
    x: (x - camera.x) * camera.zoom + canvas.width / 2,
    y: (y - camera.y) * camera.zoom + canvas.height / 2
  };
}

function circle(x, y, r, color) {
  const p = toScreen(x, y);
  ctx.beginPath();
  ctx.arc(p.x, p.y, r * camera.zoom, 0, Math.PI * 2);
  ctx.fillStyle = color;
  ctx.fill();
}

/* ==========================
   DRAW PASSES
========================== */
function drawBackground() {
  ctx.fillStyle = "white";
  for (const s of backgroundStars) {
    const p = toScreen(s.x, s.y);
    ctx.fillRect(p.x, p.y, 1, 1);
  }
}

function drawGalaxyLayer() {
  circle(system.x, system.y, SIZE.GALAXY_STAR, "#00ff66");
}

function drawSystemLayer(time) {
  // Sun
  circle(system.x, system.y, SIZE.SUN, "#ffff55");

  // Planets
  for (let i = 1; i <= system.planets; i++) {
    const angle = time * 0.00015 * i;
    const dist = i * SIZE.ORBIT_GAP;
    circle(
      system.x + Math.cos(angle) * dist,
      system.y + Math.sin(angle) * dist,
      SIZE.PLANET,
      "#66aaff"
    );
  }
}

function drawLocalLayer() {
  circle(fleet.x, fleet.y, SIZE.FLEET, "#ff3333");
}

/* ==========================
   INPUT
========================== */
let dragging = false;
let last = { x: 0, y: 0 };

canvas.addEventListener("mousedown", e => {
  dragging = true;
  last.x = e.clientX;
  last.y = e.clientY;
});
window.addEventListener("mouseup", () => dragging = false);
window.addEventListener("mousemove", e => {
  if (!dragging) return;
  camera.x -= (e.clientX - last.x) / camera.zoom;
  camera.y -= (e.clientY - last.y) / camera.zoom;
  last.x = e.clientX;
  last.y = e.clientY;
});

canvas.addEventListener("wheel", e => {
  camera.zoom *= e.deltaY > 0 ? 0.9 : 1.1;
  camera.zoom = Math.max(0.01, Math.min(2, camera.zoom));
});

/* ==========================
   MAIN LOOP
========================== */
function loop(time) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawBackground();

  if (camera.zoom >= LAYER.GALAXY) drawGalaxyLayer();
  if (camera.zoom >= LAYER.SYSTEM) drawSystemLayer(time);
  if (camera.zoom >= LAYER.LOCAL) drawLocalLayer();

  requestAnimationFrame(loop);
}

loop(0);
</script>
</body>
</html>
